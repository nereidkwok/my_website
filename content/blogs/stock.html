---
categories:
- ""
- ""
date: "2017-11-31T22:42:51-05:00"
description: Financial analysis on stock returns of and AAPL,DIS,DPZ,ANF,TSLA,SPY.
draft: false
image: picstock.jpeg
keywords: ""
slug: stocks
title: Returns of financial stocks
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>We will use the <code>tidyquant</code> package to download historical data of stock prices, calculate returns, and examine the distribution of returns.</p>
<p>We must first identify which stocks we want to download data for, and for this we must know their ticker symbol; Apple is known as AAPL, Microsoft as MSFT, McDonaldâ€™s as MCD, etc. The file <code>nyse.csv</code> contains 508 stocks listed on the NYSE, their ticker <code>symbol</code>, <code>name</code>, the IPO (Initial Public Offering) year, and the sector and industry the company is in.</p>
<pre class="r"><code>nyse &lt;- read_csv(here::here(&quot;data&quot;,&quot;nyse.csv&quot;))
glimpse(nyse)</code></pre>
<pre><code>## Rows: 508
## Columns: 6
## $ symbol        &lt;chr&gt; &quot;MMM&quot;, &quot;ABB&quot;, &quot;ABT&quot;, &quot;ABBV&quot;, &quot;ACN&quot;, &quot;AAP&quot;, &quot;AFL&quot;, &quot;A&quot;, &quot;~
## $ name          &lt;chr&gt; &quot;3M Company&quot;, &quot;ABB Ltd&quot;, &quot;Abbott Laboratories&quot;, &quot;AbbVie ~
## $ ipo_year      &lt;chr&gt; &quot;n/a&quot;, &quot;n/a&quot;, &quot;n/a&quot;, &quot;2012&quot;, &quot;2001&quot;, &quot;n/a&quot;, &quot;n/a&quot;, &quot;1999~
## $ sector        &lt;chr&gt; &quot;Health Care&quot;, &quot;Consumer Durables&quot;, &quot;Health Care&quot;, &quot;Heal~
## $ industry      &lt;chr&gt; &quot;Medical/Dental Instruments&quot;, &quot;Electrical Products&quot;, &quot;Ma~
## $ summary_quote &lt;chr&gt; &quot;https://www.nasdaq.com/symbol/mmm&quot;, &quot;https://www.nasdaq~</code></pre>
<p>Based on this dataset, a table and a bar plot was created to show the number of companies per sector, in descending order</p>
<pre class="r"><code># Create table by sector in descending order of number of companies
companiesPerSector &lt;- nyse%&gt;%
  group_by(sector)%&gt;%
  count(sort = TRUE, name = &quot;numOfComp&quot;)
companiesPerSector  </code></pre>
<pre><code>## # A tibble: 12 x 2
## # Groups:   sector [12]
##    sector                numOfComp
##    &lt;chr&gt;                     &lt;int&gt;
##  1 Finance                      97
##  2 Consumer Services            79
##  3 Public Utilities             60
##  4 Capital Goods                45
##  5 Health Care                  45
##  6 Energy                       42
##  7 Technology                   40
##  8 Basic Industries             39
##  9 Consumer Non-Durables        31
## 10 Miscellaneous                12
## 11 Transportation               10
## 12 Consumer Durables             8</code></pre>
<pre class="r"><code># Create bar plot
ggplot(companiesPerSector, aes(x = numOfComp, y = reorder(sector,numOfComp),fill=sector))+
  geom_col()+
  labs(x = &quot;Number of Companies&quot;,
       y = &quot;Sector&quot;,
       title = &quot;Number of Companies in each Sector&quot;)+
  theme_bw()+
  theme(legend.position=&quot;none&quot;)+
  NULL</code></pre>
<p><img src="/blogs/stock_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>6 stocks including the the SP500 ETF (Exchange Traded Fund) was selected to perform the analysis.</p>
<pre class="r"><code># Select prices of the 6 stocks with SPY with a time frame
myStocks &lt;- c(&quot;AAPL&quot;,&quot;DIS&quot;,&quot;DPZ&quot;,&quot;ANF&quot;,&quot;TSLA&quot;,&quot;SPY&quot; ) %&gt;%
  tq_get(get  = &quot;stock.prices&quot;,
         from = &quot;2011-01-01&quot;,
         to   = &quot;2021-08-31&quot;) %&gt;%
  group_by(symbol) 

# Examine the structure of the resulting data frame
glimpse(myStocks) </code></pre>
<pre><code>## Rows: 16,098
## Columns: 8
## Groups: symbol [6]
## $ symbol   &lt;chr&gt; &quot;AAPL&quot;, &quot;AAPL&quot;, &quot;AAPL&quot;, &quot;AAPL&quot;, &quot;AAPL&quot;, &quot;AAPL&quot;, &quot;AAPL&quot;, &quot;AAPL~
## $ date     &lt;date&gt; 2011-01-03, 2011-01-04, 2011-01-05, 2011-01-06, 2011-01-07, ~
## $ open     &lt;dbl&gt; 11.63000, 11.87286, 11.76964, 11.95429, 11.92821, 12.10107, 1~
## $ high     &lt;dbl&gt; 11.79500, 11.87500, 11.94071, 11.97321, 12.01250, 12.25821, 1~
## $ low      &lt;dbl&gt; 11.60143, 11.71964, 11.76786, 11.88929, 11.85357, 12.04179, 1~
## $ close    &lt;dbl&gt; 11.77036, 11.83179, 11.92857, 11.91893, 12.00429, 12.23036, 1~
## $ volume   &lt;dbl&gt; 445138400, 309080800, 255519600, 300428800, 311931200, 448560~
## $ adjusted &lt;dbl&gt; 10.10622, 10.15897, 10.24207, 10.23379, 10.30708, 10.50119, 1~</code></pre>
<p>Financial performance analysis depend on returns. Given the adjusted closing prices, daily, monthly, and yearly returns are calculated.</p>
<pre class="r"><code>#calculate daily returns
myStocks_returns_daily &lt;- myStocks %&gt;%
  tq_transmute(select     = adjusted, 
               mutate_fun = periodReturn, 
               period     = &quot;daily&quot;, 
               type       = &quot;log&quot;,
               col_rename = &quot;daily_returns&quot;,
               cols = c(nested.col))  

#calculate monthly  returns
myStocks_returns_monthly &lt;- myStocks %&gt;%
  tq_transmute(select     = adjusted, 
               mutate_fun = periodReturn, 
               period     = &quot;monthly&quot;, 
               type       = &quot;arithmetic&quot;,
               col_rename = &quot;monthly_returns&quot;,
               cols = c(nested.col)) 

#calculate yearly returns
myStocks_returns_annual &lt;- myStocks %&gt;%
  group_by(symbol) %&gt;%
  tq_transmute(select     = adjusted, 
               mutate_fun = periodReturn, 
               period     = &quot;yearly&quot;, 
               type       = &quot;arithmetic&quot;,
               col_rename = &quot;yearly_returns&quot;,
               cols = c(nested.col))</code></pre>
<p>A table which summarises monthly returns for each of the stocks and <code>SPY</code> with min, max, median, mean, SD.</p>
<pre class="r"><code>monthlyReturnSummary &lt;- myStocks_returns_monthly%&gt;%
  summarise(monthly_max = max(monthly_returns),
            monthly_min = min(monthly_returns),
            monthly_mean = mean(monthly_returns),
            monthly_median = median(monthly_returns),
            monthly_sd = sd(monthly_returns))
monthlyReturnSummary</code></pre>
<pre><code>## # A tibble: 6 x 6
##   symbol monthly_max monthly_min monthly_mean monthly_median monthly_sd
##   &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;          &lt;dbl&gt;      &lt;dbl&gt;
## 1 AAPL         0.217      -0.181      0.0245         0.0257      0.0785
## 2 ANF          0.507      -0.421      0.00922        0.00287     0.145 
## 3 DIS          0.234      -0.179      0.0155         0.00946     0.0682
## 4 DPZ          0.342      -0.188      0.0314         0.0253      0.0746
## 5 SPY          0.127      -0.125      0.0123         0.0174      0.0381
## 6 TSLA         0.811      -0.224      0.0523         0.0148      0.176</code></pre>
<p>Density plots for each of the stocks by faceting</p>
<pre class="r"><code>ggplot(myStocks_returns_monthly, aes(monthly_returns))+
  geom_density()+
  facet_wrap(~symbol)+
  labs(x = &quot;Distribution of Monthly Return&quot;,
       y = &quot;Probability % &quot;,
       title  = &quot;Probability Distribution of Monthly Returns&quot;)+
  theme_bw()+
  NULL</code></pre>
<p><img src="/blogs/stock_files/figure-html/density_monthly_returns-1.png" width="672" /></p>
<blockquote>
<p>Tesla is the riskiest stock as it has the highest spread, which means its monthly standard deviations are the highest. The least risky is SPY as it has the narrowest spread.</p>
</blockquote>
<p>A plot that shows the expected monthly return (mean) of a stock on the Y axis and the risk (standard deviation) in the X-axis.</p>
<pre class="r"><code># ggrepel function helps repel overlapping text labels
library(ggrepel)
ggplot(monthlyReturnSummary, aes(x = monthly_sd, y = monthly_mean))+
  geom_point(size = 4, aes(color = symbol))+
  ggrepel::geom_text_repel(aes(label = symbol), size = 4)+
  labs(x = &quot;Standard Deviation of Monthly Returns&quot;,
       y = &quot;Average Monthly Returns&quot;,
       title = &quot;Risk vs Potential Return&quot;)+
  theme_bw()+
  NULL</code></pre>
<p><img src="/blogs/stock_files/figure-html/risk_return_plot-1.png" width="672" /></p>
<blockquote>
<p>ANF is much riskier than most, while delivering the lowest returns.</p>
</blockquote>
